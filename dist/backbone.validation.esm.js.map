{"version":3,"file":"backbone.validation.esm.js","sources":["../src/utils.js","../src/options.js","../src/validators.js","../src/index.js"],"sourcesContent":["import _ from 'underscore'\r\n\r\n// Flattens an object\r\n// eg:\r\n//\r\n//     var o = {\r\n//       owner: {\r\n//         name: 'Backbone',\r\n//         address: {\r\n//           street: 'Street',\r\n//           zip: 1234\r\n//         }\r\n//       }\r\n//     };\r\n//\r\n// becomes:\r\n//\r\n//     var o = {\r\n//       'owner': {\r\n//         name: 'Backbone',\r\n//         address: {\r\n//           street: 'Street',\r\n//           zip: 1234\r\n//         }\r\n//       },\r\n//       'owner.name': 'Backbone',\r\n//       'owner.address': {\r\n//         street: 'Street',\r\n//         zip: 1234\r\n//       },\r\n//       'owner.address.street': 'Street',\r\n//       'owner.address.zip': 1234\r\n//     };\r\n// This may seem redundant, but it allows for maximum flexibility\r\n// in validation rules.\r\n\r\nvar flatten = function (obj, into, prefix) {\r\n  into = into || {};\r\n  prefix = prefix || '';\r\n\r\n  _.each(obj, function(val, key) {\r\n    if(obj.hasOwnProperty(key)) {\r\n      if (!!val && typeof val === 'object' && val.constructor === Object) {\r\n        flatten(val, into, prefix + key + '.');\r\n      }\r\n\r\n      // Register the current level object as well\r\n      into[prefix + key] = val;\r\n    }\r\n  });\r\n\r\n  return into;\r\n};\r\n\r\n// Determines whether or not a value is empty\r\nvar hasValue = function(value) {\r\n  return !(_.isNull(value) || _.isUndefined(value) || (_.isString(value) && trim(value) === '') || (_.isArray(value) && _.isEmpty(value)));\r\n};\r\n\r\n// Use native trim when defined\r\nvar trim = String.prototype.trim ?\r\n  function(text) {\r\n    return text.trim();\r\n  } :\r\n  function(text) {\r\n    var trimLeft = /^\\s+/,\r\n      trimRight = /\\s+$/;\r\n\r\n    return text.toString().replace(trimLeft, '').replace(trimRight, '');\r\n  };\r\n\r\nexport {flatten, hasValue}","// Default options\r\n// ---------------\r\n\r\nvar defaultOptions = {\r\n  forceUpdate: false,\r\n  setInvalidAttrs: false,\r\n  selector: 'name',\r\n  labelFormatter: 'sentenceCase',\r\n  valid: Function.prototype,\r\n  invalid: Function.prototype\r\n};\r\n\r\n\r\nexport {defaultOptions};","import _ from 'underscore'\r\nimport {hasValue} from './utils'\r\nimport {defaultOptions} from './options';\r\n\r\n// Formatting functions used for formatting error messages\r\n\r\n// Uses the configured label formatter to format the attribute name\r\n// to make it more readable for the user\r\nfunction formatLabel(attrName, model) {\r\n  return defaultLabelFormatters[defaultOptions.labelFormatter](attrName, model);\r\n}\r\n\r\n// Replaces numeric placeholders like {0} in a string with arguments\r\n// passed to the function\r\nfunction format() {\r\n  var args = Array.prototype.slice.call(arguments),\r\n    text = args.shift();\r\n  return text.replace(/{(\\d+)}/g, function(match, number) {\r\n    return typeof args[number] !== 'undefined' ? args[number] : match;\r\n  });\r\n}\r\n\r\n// Label formatters\r\n// ----------------\r\n\r\n// Label formatters are used to convert the attribute name\r\n// to a more human friendly label when using the built in\r\n// error messages.\r\n// Configure which one to use with a call to\r\n//\r\n//     Backbone.Validation.configure({\r\n//       labelFormatter: 'label'\r\n//     });\r\nvar defaultLabelFormatters = {\r\n\r\n  // Returns the attribute name with applying any formatting\r\n  none: function(attrName) {\r\n    return attrName;\r\n  },\r\n\r\n  // Converts attributeName or attribute_name to Attribute name\r\n  sentenceCase: function(attrName) {\r\n    return attrName.replace(/(?:^\\w|[A-Z]|\\b\\w)/g, function(match, index) {\r\n      return index === 0 ? match.toUpperCase() : ' ' + match.toLowerCase();\r\n    }).replace(/_/g, ' ');\r\n  },\r\n\r\n  // Looks for a label configured on the model and returns it\r\n  //\r\n  //      var Model = Backbone.Model.extend({\r\n  //        validation: {\r\n  //          someAttribute: {\r\n  //            required: true\r\n  //          }\r\n  //        },\r\n  //\r\n  //        labels: {\r\n  //          someAttribute: 'Custom label'\r\n  //        }\r\n  //      });\r\n  label: function(attrName, model) {\r\n    return (model.labels && model.labels[attrName]) || defaultLabelFormatters.sentenceCase(attrName, model);\r\n  }\r\n};\r\n\r\n\r\n\r\n// Patterns\r\n// --------\r\n\r\nvar defaultPatterns = {\r\n  // Matches any digit(s) (i.e. 0-9)\r\n  digits: /^\\d+$/,\r\n\r\n  // Matches any number (e.g. 100.000)\r\n  number: /^-?(?:\\d+|\\d{1,3}(?:,\\d{3})+)?(?:\\.\\d*)?$/,\r\n\r\n  // Matches a valid email address (e.g. mail@example.com)\r\n  email: /^((([a-z]|\\d|[\\[\\]()!#\\$%&'\\*\\+\\-\\/=\\?\\^_`{\\|}~]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])+(\\.([a-z]|\\d|[\\[\\]()!#\\$%&'\\*\\+\\-\\/=\\?\\^_`{\\|}~]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])+)*)|((\\x22)((((\\x20|\\x09)*(\\x0d\\x0a))?(\\x20|\\x09)+)?(([\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x7f]|\\x21|[\\x23-\\x5b]|[\\x5d-\\x7e]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(\\\\([\\x01-\\x09\\x0b\\x0c\\x0d-\\x7f]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]))))*(((\\x20|\\x09)*(\\x0d\\x0a))?(\\x20|\\x09)+)?(\\x22)))@((([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))\\.)+(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))$/i,\r\n\r\n  // Mathes any valid url (e.g. http://www.xample.com)\r\n  url: /^(https?|ftp):\\/\\/(((([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:)*@)?(((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5]))|((([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))\\.)+(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))\\.?)(:\\d*)?)(\\/((([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:|@)+(\\/(([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:|@)*)*)?)?(\\?((([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:|@)|[\\uE000-\\uF8FF]|\\/|\\?)*)?(\\#((([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(%[\\da-f]{2})|[!\\$&'\\(\\)\\*\\+,;=]|:|@)|\\/|\\?)*)?$/i\r\n};\r\n\r\n\r\n// Error messages\r\n// --------------\r\n\r\n// Error message for the build in validators.\r\n// {x} gets swapped out with arguments from the validator.\r\nvar defaultMessages = {\r\n  required: '{0} is required',\r\n  acceptance: '{0} must be accepted',\r\n  min: '{0} must be greater than or equal to {1}',\r\n  max: '{0} must be less than or equal to {1}',\r\n  range: '{0} must be between {1} and {2}',\r\n  length: '{0} must be {1} characters',\r\n  minLength: '{0} must be at least {1} characters',\r\n  maxLength: '{0} must be at most {1} characters',\r\n  rangeLength: '{0} must be between {1} and {2} characters',\r\n  oneOf: '{0} must be one of: {1}',\r\n  equalTo: '{0} must be the same as {1}',\r\n  digits: '{0} must only contain digits',\r\n  number: '{0} must be a number',\r\n  email: '{0} must be a valid email',\r\n  url: '{0} must be a valid url',\r\n  inlinePattern: '{0} is invalid'\r\n};\r\n\r\n// Built in validators\r\n// -------------------\r\n\r\n// Determines whether or not a value is a number\r\nvar isNumber = function(value){\r\n  return _.isNumber(value) || (_.isString(value) && value.match(defaultPatterns.number));\r\n};\r\n\r\nvar defaultValidators =  {\r\n  // Function validator\r\n  // Lets you implement a custom function used for validation\r\n  fn: function(value, attr, fn, model, computed) {\r\n    if(_.isString(fn)){\r\n      fn = model[fn];\r\n    }\r\n    return fn.call(model, value, attr, computed);\r\n  },\r\n\r\n  // Required validator\r\n  // Validates if the attribute is required or not\r\n  // This can be specified as either a boolean value or a function that returns a boolean value\r\n  required: function(value, attr, required, model, computed) {\r\n    var isRequired = _.isFunction(required) ? required.call(model, value, attr, computed) : required;\r\n    if(!isRequired && !hasValue(value)) {\r\n      return false; // overrides all other validators\r\n    }\r\n    if (isRequired && !hasValue(value)) {\r\n      return this.format(defaultMessages.required, this.formatLabel(attr, model));\r\n    }\r\n  },\r\n\r\n  // Acceptance validator\r\n  // Validates that something has to be accepted, e.g. terms of use\r\n  // `true` or 'true' are valid\r\n  acceptance: function(value, attr, accept, model) {\r\n    if(value !== 'true' && (!_.isBoolean(value) || value === false)) {\r\n      return this.format(defaultMessages.acceptance, this.formatLabel(attr, model));\r\n    }\r\n  },\r\n\r\n  // Min validator\r\n  // Validates that the value has to be a number and equal to or greater than\r\n  // the min value specified\r\n  min: function(value, attr, minValue, model) {\r\n    if (!isNumber(value) || value < minValue) {\r\n      return this.format(defaultMessages.min, this.formatLabel(attr, model), minValue);\r\n    }\r\n  },\r\n\r\n  // Max validator\r\n  // Validates that the value has to be a number and equal to or less than\r\n  // the max value specified\r\n  max: function(value, attr, maxValue, model) {\r\n    if (!isNumber(value) || value > maxValue) {\r\n      return this.format(defaultMessages.max, this.formatLabel(attr, model), maxValue);\r\n    }\r\n  },\r\n\r\n  // Range validator\r\n  // Validates that the value has to be a number and equal to or between\r\n  // the two numbers specified\r\n  range: function(value, attr, range, model) {\r\n    if(!isNumber(value) || value < range[0] || value > range[1]) {\r\n      return this.format(defaultMessages.range, this.formatLabel(attr, model), range[0], range[1]);\r\n    }\r\n  },\r\n\r\n  // Length validator\r\n  // Validates that the value has to be a string with length equal to\r\n  // the length value specified\r\n  length: function(value, attr, length, model) {\r\n    if (!_.isString(value) || value.length !== length) {\r\n      return this.format(defaultMessages.length, this.formatLabel(attr, model), length);\r\n    }\r\n  },\r\n\r\n  // Min length validator\r\n  // Validates that the value has to be a string with length equal to or greater than\r\n  // the min length value specified\r\n  minLength: function(value, attr, minLength, model) {\r\n    if (!_.isString(value) || value.length < minLength) {\r\n      return this.format(defaultMessages.minLength, this.formatLabel(attr, model), minLength);\r\n    }\r\n  },\r\n\r\n  // Max length validator\r\n  // Validates that the value has to be a string with length equal to or less than\r\n  // the max length value specified\r\n  maxLength: function(value, attr, maxLength, model) {\r\n    if (!_.isString(value) || value.length > maxLength) {\r\n      return this.format(defaultMessages.maxLength, this.formatLabel(attr, model), maxLength);\r\n    }\r\n  },\r\n\r\n  // Range length validator\r\n  // Validates that the value has to be a string and equal to or between\r\n  // the two numbers specified\r\n  rangeLength: function(value, attr, range, model) {\r\n    if (!_.isString(value) || value.length < range[0] || value.length > range[1]) {\r\n      return this.format(defaultMessages.rangeLength, this.formatLabel(attr, model), range[0], range[1]);\r\n    }\r\n  },\r\n\r\n  // One of validator\r\n  // Validates that the value has to be equal to one of the elements in\r\n  // the specified array. Case sensitive matching\r\n  oneOf: function(value, attr, values, model) {\r\n    if(!_.include(values, value)){\r\n      return this.format(defaultMessages.oneOf, this.formatLabel(attr, model), values.join(', '));\r\n    }\r\n  },\r\n\r\n  // Equal to validator\r\n  // Validates that the value has to be equal to the value of the attribute\r\n  // with the name specified\r\n  equalTo: function(value, attr, equalTo, model, computed) {\r\n    if(value !== computed[equalTo]) {\r\n      return this.format(defaultMessages.equalTo, this.formatLabel(attr, model), this.formatLabel(equalTo, model));\r\n    }\r\n  },\r\n\r\n  // Pattern validator\r\n  // Validates that the value has to match the pattern specified.\r\n  // Can be a regular expression or the name of one of the built in patterns\r\n  pattern: function(value, attr, pattern, model) {\r\n    if (!hasValue(value) || !value.toString().match(defaultPatterns[pattern] || pattern)) {\r\n      return this.format(defaultMessages[pattern] || defaultMessages.inlinePattern, this.formatLabel(attr, model), pattern);\r\n    }\r\n  }\r\n};\r\n\r\n// Set helper functions using Object.defineProperty (non writable, configurable or enumerable)\r\nObject.defineProperty(defaultValidators, 'format', {value: format})\r\nObject.defineProperty(defaultValidators, 'formatLabel', {value: formatLabel})\r\n\r\n\r\nexport {defaultMessages, defaultPatterns, defaultValidators, defaultLabelFormatters}","import Backbone from 'backbone';\r\nimport _ from 'underscore';\r\nimport {flatten} from './utils';\r\nimport {defaultOptions} from './options';\r\nimport {defaultMessages, defaultPatterns, defaultValidators, defaultLabelFormatters} from './validators';\r\n\r\n\r\n\r\n// Helper functions\r\n// ----------------\r\n\r\n// Returns an object with undefined properties for all\r\n// attributes on the model that has defined one or more\r\n// validation rules.\r\nvar getValidatedAttrs = function(model, attrs) {\r\n  attrs = attrs || _.keys(_.result(model, 'validation') || {});\r\n  return _.reduce(attrs, function(memo, key) {\r\n    memo[key] = void 0;\r\n    return memo;\r\n  }, {});\r\n};\r\n\r\n// Returns an array with attributes passed through options\r\nvar getOptionsAttrs = function(options, view) {\r\n  var attrs = options.attributes;\r\n  if (_.isFunction(attrs)) {\r\n    attrs = attrs(view);\r\n  } else if (_.isString(attrs) && (_.isFunction(defaultAttributeLoaders[attrs]))) {\r\n    attrs = defaultAttributeLoaders[attrs](view);\r\n  }\r\n  if (_.isArray(attrs)) {\r\n    return attrs;\r\n  }\r\n};\r\n\r\n\r\n// Looks on the model for validations for a specified\r\n// attribute. Returns an array of any validators defined,\r\n// or an empty array if none is defined.\r\nvar getValidators = function(model, attr) {\r\n  var attrValidationSet = model.validation ? _.result(model, 'validation')[attr] || {} : {};\r\n\r\n  // Stick the validator object into an array\r\n  if(!_.isArray(attrValidationSet)) {\r\n    attrValidationSet = [attrValidationSet];\r\n  }\r\n\r\n  // Reduces the array of validators into a new array with objects\r\n  // with a validation method to call, the value to validate against\r\n  // and the specified error message, if any\r\n  return _.reduce(attrValidationSet, function(memo, attrValidation) {\r\n\r\n    // If the validator is a function or a string, wrap it in a function validator\r\n    if (_.isFunction(attrValidation) || _.isString(attrValidation)) {\r\n      attrValidation = {\r\n        fn: attrValidation\r\n      };\r\n    }\r\n\r\n    _.each(_.keys(attrValidation), function(validator) {\r\n      if (validator === 'msg') return;\r\n      memo.push({\r\n        fn: defaultValidators[validator],\r\n        val: attrValidation[validator],\r\n        msg: attrValidation.msg\r\n      });\r\n    });\r\n    return memo;\r\n  }, []);\r\n};\r\n\r\n// Validates an attribute against all validators defined\r\n// for that attribute. If one or more errors are found,\r\n// the first error message is returned.\r\n// If the attribute is valid, an empty string is returned.\r\nvar validateAttr = function(model, attr, value, computed) {\r\n  // Reduces the array of validators to an error message by\r\n  // applying all the validators and returning the first error\r\n  // message, if any.\r\n  return _.reduce(getValidators(model, attr), function(memo, validator){\r\n    var result = validator.fn.call(defaultValidators, value, attr, validator.val, model, computed);\r\n\r\n    if(result === false || memo === false) {\r\n      return false;\r\n    }\r\n    if (result && !memo) {\r\n      return _.result(validator, 'msg') || result;\r\n    }\r\n    return memo;\r\n  }, '');\r\n};\r\n\r\n// Loops through the model's attributes and validates the specified attrs.\r\n// Returns and object containing names of invalid attributes\r\n// as well as error messages.\r\nvar validateModel = function(model, allAttrs, validatedAttrs) {\r\n  var error,\r\n      invalidAttrs = {},\r\n      isValid = true;\r\n\r\n  _.each(validatedAttrs, function(val, attr) {\r\n    error = validateAttr(model, attr, val, allAttrs);\r\n    if (error) {\r\n      invalidAttrs[attr] = error;\r\n      isValid = false;\r\n    }\r\n  });\r\n\r\n  return {\r\n    invalidAttrs: invalidAttrs,\r\n    isValid: isValid\r\n  };\r\n};\r\n\r\n// Contains the methods that are mixed in on the model when binding\r\nvar mixin = function(view, options) {\r\n  return {\r\n\r\n    // Check whether or not a value, or a hash of values\r\n    // passes validation without updating the model\r\n    preValidate: function(attr, value) {\r\n      var self = this,\r\n          result = {},\r\n          error,\r\n          allAttrs = _.extend({}, this.attributes);\r\n\r\n      if(_.isObject(attr)){\r\n        // if multiple attributes are passed at once we would like for the validation functions to\r\n        // have access to the fresh values sent for all attributes, in the same way they do in the\r\n        // regular validation\r\n        _.extend(allAttrs, attr);\r\n\r\n        _.each(attr, function(value, attrKey) {\r\n          error = validateAttr(self, attrKey, value, allAttrs);\r\n          if(error){\r\n            result[attrKey] = error;\r\n          }\r\n        });\r\n\r\n        return _.isEmpty(result) ? undefined : result;\r\n      }\r\n      else {\r\n        return validateAttr(this, attr, value, allAttrs);\r\n      }\r\n    },\r\n\r\n    // Check to see if an attribute, an array of attributes or the\r\n    // entire model is valid. Passing true will force a validation\r\n    // of the model.\r\n    isValid: function(option) {\r\n      var self = this, flattened, attrs, error, invalidAttrs;\r\n\r\n      option = option || getOptionsAttrs(options, view);\r\n\r\n      if(_.isString(option)){\r\n        attrs = [option];\r\n      } else if(_.isArray(option)) {\r\n        attrs = option;\r\n      }\r\n      if (attrs) {\r\n        flattened = flatten(self.attributes);\r\n        //Loop through all attributes and mark attributes invalid if appropriate\r\n        _.each(attrs, function (attr) {\r\n          error = validateAttr(self, attr, flattened[attr], _.extend({}, self.attributes));\r\n          if (error) {\r\n              invalidAttrs = invalidAttrs || {};\r\n              invalidAttrs[attr] = error;\r\n          }\r\n          //trigger valid/invalid events for each associated view\r\n          _.each(self.associatedViews, function(view) {\r\n            if (error) {\r\n              options.invalid(view, attr, error, options.selector, self);\r\n            } else {\r\n              options.valid(view, attr, options.selector, self);\r\n            }\r\n          });\r\n        });\r\n      }\r\n\r\n      if(option === true) {\r\n        invalidAttrs = this.validate();\r\n      }\r\n      if (invalidAttrs) {\r\n        this.trigger('invalid', this, invalidAttrs, {validationError: invalidAttrs});\r\n      }\r\n      return attrs ? !invalidAttrs : this.validation ? this._isValid : true;\r\n    },\r\n\r\n    // This is called by Backbone when it needs to perform validation.\r\n    // You can call it manually without any parameters to validate the\r\n    // entire model.\r\n    validate: function(attrs, setOptions){\r\n      var model = this,\r\n          validateAll = !attrs,\r\n          opt = _.extend({}, options, setOptions),\r\n          validatedAttrs = getValidatedAttrs(model, getOptionsAttrs(options, view)),\r\n          allAttrs = _.extend({}, validatedAttrs, model.attributes, attrs),\r\n          flattened = flatten(allAttrs),\r\n          changedAttrs = attrs ? flatten(attrs) : flattened,\r\n          result = validateModel(model, allAttrs, _.pick(flattened, _.keys(validatedAttrs)));\r\n\r\n      model._isValid = result.isValid;\r\n\r\n      //After validation is performed, loop through all associated views\r\n      _.each(model.associatedViews, function(view){\r\n\r\n        // After validation is performed, loop through all validated and changed attributes\r\n        // and call the valid and invalid callbacks so the view is updated.\r\n        _.each(validatedAttrs, function(val, attr){\r\n            var invalid = result.invalidAttrs.hasOwnProperty(attr),\r\n              changed = changedAttrs.hasOwnProperty(attr);\r\n\r\n            if(!invalid){\r\n              opt.valid(view, attr, opt.selector, model);\r\n            }\r\n            if(invalid && (changed || validateAll)){\r\n              opt.invalid(view, attr, result.invalidAttrs[attr], opt.selector, model);\r\n            }\r\n        });\r\n      });\r\n\r\n      if (options.setInvalidAttrs) model.invalidAttrs = result.invalidAttrs;\r\n\r\n      // Trigger validated events.\r\n      // Need to defer this so the model is actually updated before\r\n      // the event is triggered.\r\n      _.defer(function() {\r\n        model.trigger('validated', model._isValid, model, result.invalidAttrs);\r\n        model.trigger('validated:' + (model._isValid ? 'valid' : 'invalid'), model, result.invalidAttrs);\r\n      });\r\n\r\n      // Return any error messages to Backbone, unless the forceUpdate flag is set.\r\n      // Then we do not return anything and fools Backbone to believe the validation was\r\n      // a success. That way Backbone will update the model regardless.\r\n      if (!opt.forceUpdate && _.intersection(_.keys(result.invalidAttrs), _.keys(changedAttrs)).length > 0) {\r\n        return result.invalidAttrs;\r\n      }\r\n    }\r\n  };\r\n};\r\n\r\n// Helper to mix in validation on a model. Stores the view in the associated views array.\r\nvar bindModel = function(view, model, options) {\r\n  if (model.associatedViews) {\r\n    model.associatedViews.push(view);\r\n  } else {\r\n    model.associatedViews = [view];\r\n  }\r\n  _.extend(model, mixin(view, options));\r\n};\r\n\r\n// Removes view from associated views of the model or the methods\r\n// added to a model if no view or single view provided\r\nvar unbindModel = function(model, view) {\r\n  if (view && model.associatedViews && model.associatedViews.length > 1){\r\n    model.associatedViews = _.without(model.associatedViews, view);\r\n  } else {\r\n    delete model.validate;\r\n    delete model.preValidate;\r\n    delete model.isValid;\r\n    delete model.associatedViews;\r\n  }\r\n};\r\n\r\n// Mix in validation on a model whenever a model is\r\n// added to a collection\r\nvar collectionAdd = function(model) {\r\n  bindModel(this.view, model, this.options);\r\n};\r\n\r\n// Remove validation from a model whenever a model is\r\n// removed from a collection\r\nvar collectionRemove = function(model) {\r\n  unbindModel(model);\r\n};\r\n\r\n// Public interface\r\nvar Validation =  {\r\n\r\n  // Current version of the library\r\n  version: '{{version}}',\r\n\r\n  // Called to configure the default options\r\n  configure: function(options) {\r\n    _.extend(defaultOptions, options);\r\n  },\r\n\r\n  // Hooks up validation on a view with a model\r\n  // or collection\r\n  bind: function(view, options) {\r\n    options = _.extend({}, defaultOptions, defaultCallbacks, options);\r\n\r\n    var model = options.model || view.model,\r\n        collection = options.collection || view.collection;\r\n\r\n    if(typeof model === 'undefined' && typeof collection === 'undefined'){\r\n      throw 'Before you execute the binding your view must have a model or a collection.\\n' +\r\n            'See http://thedersen.com/projects/backbone-validation/#using-form-model-validation for more information.';\r\n    }\r\n\r\n    if(model) {\r\n      bindModel(view, model, options);\r\n    }\r\n    else if(collection) {\r\n      collection.each(function(model){\r\n        bindModel(view, model, options);\r\n      });\r\n      collection.bind('add', collectionAdd, {view: view, options: options});\r\n      collection.bind('remove', collectionRemove);\r\n    }\r\n  },\r\n\r\n  // Removes validation from a view with a model\r\n  // or collection\r\n  unbind: function(view, options) {\r\n    options = _.extend({}, options);\r\n    var model = options.model || view.model,\r\n        collection = options.collection || view.collection;\r\n\r\n    if(model) {\r\n      unbindModel(model, view);\r\n    }\r\n    else if(collection) {\r\n      collection.each(function(model){\r\n        unbindModel(model, view);\r\n      });\r\n      collection.unbind('add', collectionAdd);\r\n      collection.unbind('remove', collectionRemove);\r\n    }\r\n  },\r\n\r\n  // Used to extend the Backbone.Model.prototype\r\n  // with validation\r\n  mixin: mixin(null, defaultOptions)\r\n};\r\n\r\n\r\n\r\n// Callbacks\r\n// ---------\r\n\r\nvar defaultCallbacks = Validation.callbacks = {\r\n\r\n  // Gets called when a previously invalid field in the\r\n  // view becomes valid. Removes any error message.\r\n  // Should be overridden with custom functionality.\r\n  valid: function(view, attr, selector) {\r\n    view.$('[' + selector + '~=\"' + attr + '\"]')\r\n        .removeClass('invalid')\r\n        .removeAttr('data-error');\r\n  },\r\n\r\n  // Gets called when a field in the view becomes invalid.\r\n  // Adds a error message.\r\n  // Should be overridden with custom functionality.\r\n  invalid: function(view, attr, error, selector) {\r\n    view.$('[' + selector + '~=\"' + attr + '\"]')\r\n        .addClass('invalid')\r\n        .attr('data-error', error);\r\n  }\r\n};\r\n\r\n// AttributeLoaders\r\n\r\nvar defaultAttributeLoaders = Validation.attributeLoaders = {\r\n  inputNames: function (view) {\r\n    var attrs = [];\r\n    if (view) {\r\n      view.$('form [name]').each(function () {\r\n        if (/^(?:input|select|textarea)$/i.test(this.nodeName) && this.name &&\r\n          this.type !== 'submit' && attrs.indexOf(this.name) === -1) {\r\n          attrs.push(this.name);\r\n        }\r\n      });\r\n    }\r\n    return attrs;\r\n  }\r\n};\r\n\r\nValidation.labelFormatters = defaultLabelFormatters;\r\nValidation.messages = defaultMessages;\r\nValidation.validators = defaultValidators;\r\nValidation.patterns = defaultPatterns;\r\n\r\nBackbone.Validation = Validation\r\n\r\nexport default Validation\r\n\r\n"],"names":[],"mappings":"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"}