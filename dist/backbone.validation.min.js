!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("underscore"),require("backbone")):"function"==typeof define&&define.amd?define(["underscore","backbone"],e):(t.Backbone=t.Backbone||{},t.Backbone.Validation=e(t._,t.Backbone))}(this,function(t,e){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t,e=e&&e.hasOwnProperty("default")?e.default:e;var n=function(e,i,u){return i=i||{},u=u||"",t.each(e,function(t,a){e.hasOwnProperty(a)&&(t&&"object"==typeof t&&t.constructor===Object&&n(t,i,u+a+"."),i[u+a]=t)}),i},i=function(e){return!(t.isNull(e)||t.isUndefined(e)||t.isString(e)&&""===u(e)||t.isArray(e)&&t.isEmpty(e))},u=String.prototype.trim?function(t){return t.trim()}:function(t){return t.toString().replace(/^\s+/,"").replace(/\s+$/,"")},a={forceUpdate:!1,selector:"name",labelFormatter:"sentenceCase",valid:Function.prototype,invalid:Function.prototype};var r={none:function(t){return t},sentenceCase:function(t){return t.replace(/(?:^\w|[A-Z]|\b\w)/g,function(t,e){return 0===e?t.toUpperCase():" "+t.toLowerCase()}).replace(/_/g," ")},label:function(t,e){return e.labels&&e.labels[t]||r.sentenceCase(t,e)}},F={digits:/^\d+$/,number:/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d*)?$/,email:/^((([a-z]|\d|[\[\]()!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[\[\]()!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i,url:/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i},o={required:"{0} is required",acceptance:"{0} must be accepted",min:"{0} must be greater than or equal to {1}",max:"{0} must be less than or equal to {1}",range:"{0} must be between {1} and {2}",length:"{0} must be {1} characters",minLength:"{0} must be at least {1} characters",maxLength:"{0} must be at most {1} characters",rangeLength:"{0} must be between {1} and {2} characters",oneOf:"{0} must be one of: {1}",equalTo:"{0} must be the same as {1}",digits:"{0} must only contain digits",number:"{0} must be a number",email:"{0} must be a valid email",url:"{0} must be a valid url",inlinePattern:"{0} is invalid"},s=function(e){return t.isNumber(e)||t.isString(e)&&e.match(F.number)},d={fn:function(e,n,i,u,a){return t.isString(i)&&(i=u[i]),i.call(u,e,n,a)},required:function(e,n,u,a,r){var F=t.isFunction(u)?u.call(a,e,n,r):u;return!(!F&&!i(e))&&(F&&!i(e)?this.format(o.required,this.formatLabel(n,a)):void 0)},acceptance:function(e,n,i,u){if("true"!==e&&(!t.isBoolean(e)||!1===e))return this.format(o.acceptance,this.formatLabel(n,u))},min:function(t,e,n,i){if(!s(t)||t<n)return this.format(o.min,this.formatLabel(e,i),n)},max:function(t,e,n,i){if(!s(t)||t>n)return this.format(o.max,this.formatLabel(e,i),n)},range:function(t,e,n,i){if(!s(t)||t<n[0]||t>n[1])return this.format(o.range,this.formatLabel(e,i),n[0],n[1])},length:function(e,n,i,u){if(!t.isString(e)||e.length!==i)return this.format(o.length,this.formatLabel(n,u),i)},minLength:function(e,n,i,u){if(!t.isString(e)||e.length<i)return this.format(o.minLength,this.formatLabel(n,u),i)},maxLength:function(e,n,i,u){if(!t.isString(e)||e.length>i)return this.format(o.maxLength,this.formatLabel(n,u),i)},rangeLength:function(e,n,i,u){if(!t.isString(e)||e.length<i[0]||e.length>i[1])return this.format(o.rangeLength,this.formatLabel(n,u),i[0],i[1])},oneOf:function(e,n,i,u){if(!t.include(i,e))return this.format(o.oneOf,this.formatLabel(n,u),i.join(", "))},equalTo:function(t,e,n,i,u){if(t!==u[n])return this.format(o.equalTo,this.formatLabel(e,i),this.formatLabel(n,i))},pattern:function(t,e,n,u){if(!i(t)||!t.toString().match(F[n]||n))return this.format(o[n]||o.inlinePattern,this.formatLabel(e,u),n)}};Object.defineProperty(d,"format",{value:function(){var t=Array.prototype.slice.call(arguments);return t.shift().replace(/{(\d+)}/g,function(e,n){return void 0!==t[n]?t[n]:e})}}),Object.defineProperty(d,"formatLabel",{value:function(t,e){return r[a.labelFormatter](t,e)}});var c=function(e,n){var i=e.attributes;if(t.isFunction(i)?i=i(n):t.isString(i)&&t.isFunction(p[i])&&(i=p[i](n)),t.isArray(i))return i},l=function(e,n,i,u){return t.reduce(function(e,n){var i=e.validation&&t.result(e,"validation")[n]||{};return t.isArray(i)||(i=[i]),t.reduce(i,function(e,n){return(t.isFunction(n)||t.isString(n))&&(n={fn:n}),t.each(t.keys(n),function(t){"msg"!==t&&e.push({fn:d[t],val:n[t],msg:n.msg})}),e},[])}(e,n),function(a,r){var F=r.fn.call(d,i,n,r.val,e,u);return!1!==F&&!1!==a&&(F&&!a?t.result(r,"msg")||F:a)},"")},f=function(e,i){return{preValidate:function(e,n){var i,u=this,a={},r=t.extend({},this.attributes);return t.isObject(e)?(t.extend(r,e),t.each(e,function(t,e){(i=l(u,e,t,r))&&(a[e]=i)}),t.isEmpty(a)?void 0:a):l(this,e,n,r)},isValid:function(u){var a,r,F,o,s=this;return u=u||c(i,e),t.isString(u)?r=[u]:t.isArray(u)&&(r=u),r&&(a=n(s.attributes),t.each(r,function(e){(F=l(s,e,a[e],t.extend({},s.attributes)))&&((o=o||{})[e]=F),t.each(s.associatedViews,function(t){F?i.invalid(t,e,F,i.selector,s):i.valid(t,e,i.selector,s)})})),!0===u&&(o=this.validate()),o&&this.trigger("invalid",this,o,{validationError:o}),r?!o:!this.validation||this._isValid},validate:function(u,a){var r=this,F=!u,o=t.extend({},i,a),s=function(e,n){return n=n||t.keys(t.result(e,"validation")||{}),t.reduce(n,function(t,e){return t[e]=void 0,t},{})}(r,c(i,e)),d=t.extend({},s,r.attributes,u),f=n(d),m=u?n(u):f,h=function(e,n,i){var u,a={},r=!0;return t.each(i,function(t,i){(u=l(e,i,t,n))&&(a[i]=u,r=!1)}),{invalidAttrs:a,isValid:r}}(r,d,t.pick(f,t.keys(s)));if(r._isValid=h.isValid,t.each(r.associatedViews,function(e){t.each(s,function(t,n){var i=h.invalidAttrs.hasOwnProperty(n),u=m.hasOwnProperty(n);i||o.valid(e,n,o.selector,r),i&&(u||F)&&o.invalid(e,n,h.invalidAttrs[n],o.selector,r)})}),t.defer(function(){r.trigger("validated",r._isValid,r,h.invalidAttrs),r.trigger("validated:"+(r._isValid?"valid":"invalid"),r,h.invalidAttrs)}),!o.forceUpdate&&t.intersection(t.keys(h.invalidAttrs),t.keys(m)).length>0)return h.invalidAttrs}}},m=function(e,n,i){n.associatedViews?n.associatedViews.push(e):n.associatedViews=[e],t.extend(n,f(e,i))},h=function(e,n){n&&e.associatedViews&&e.associatedViews.length>1?e.associatedViews=t.without(e.associatedViews,n):(delete e.validate,delete e.preValidate,delete e.isValid,delete e.associatedViews)},b=function(t){m(this.view,t,this.options)},D=function(t){h(t)},v={version:"0.13.0",configure:function(e){t.extend(a,e)},bind:function(e,n){var i=(n=t.extend({},a,g,n)).model||e.model,u=n.collection||e.collection;if(void 0===i&&void 0===u)throw"Before you execute the binding your view must have a model or a collection.\nSee http://thedersen.com/projects/backbone-validation/#using-form-model-validation for more information.";i?m(e,i,n):u&&(u.each(function(t){m(e,t,n)}),u.bind("add",b,{view:e,options:n}),u.bind("remove",D))},unbind:function(e,n){var i=(n=t.extend({},n)).model||e.model,u=n.collection||e.collection;i?h(i,e):u&&(u.each(function(t){h(t,e)}),u.unbind("add",b),u.unbind("remove",D))},mixin:f(null,a)},g=v.callbacks={valid:function(t,e,n){t.$("["+n+'~="'+e+'"]').removeClass("invalid").removeAttr("data-error")},invalid:function(t,e,n,i){t.$("["+i+'~="'+e+'"]').addClass("invalid").attr("data-error",n)}},p=v.attributeLoaders={inputNames:function(t){var e=[];return t&&t.$("form [name]").each(function(){/^(?:input|select|textarea)$/i.test(this.nodeName)&&this.name&&"submit"!==this.type&&-1===e.indexOf(this.name)&&e.push(this.name)}),e}};return v.labelFormatters=r,v.messages=o,v.validators=d,v.patterns=F,e.Validation=v,v});
//# sourceMappingURL=backbone.validation.min.js.map
