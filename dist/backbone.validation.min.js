// Backbone.Validation v0.12
//
// Copyright (c) 2011-2018 Thomas Pedersen
// Distributed under MIT License
//
// Documentation and full license available at:
// https://github.com/blikblum/backbone.validation

!function(t){"object"==typeof exports?module.exports=t(require("backbone"),require("underscore")):"function"==typeof define&&define.amd&&define(["backbone","underscore"],t)}(function(t,e){return t.Validation=function(x){"use strict";var p,A,n,u,a,r,F,e,o,s,d={forceUpdate:!1,selector:"name",labelFormatter:"sentenceCase",valid:Function.prototype,invalid:Function.prototype},c={formatLabel:function(t,e){return i[d.labelFormatter](t,e)},format:function(){var i=Array.prototype.slice.call(arguments);return i.shift().replace(/\{(\d+)\}/g,function(t,e){return void 0!==i[e]?i[e]:t})}},C=function(i,n,u){return n=n||{},u=u||"",x.each(i,function(t,e){i.hasOwnProperty(e)&&(t&&"object"==typeof t&&t.constructor===Object&&C(t,n,u+e+"."),n[u+e]=t)}),n},t=(p=function(t,e){var i=t.attributes;if(x.isFunction(i)?i=i(e):x.isString(i)&&x.isFunction(h[i])&&(i=h[i](e)),x.isArray(i))return i},A=function(u,a,r,F){return x.reduce((e=a,i=(t=u).validation&&x.result(t,"validation")[e]||{},x.isArray(i)||(i=[i]),x.reduce(i,function(e,i){return(x.isFunction(i)||x.isString(i))&&(i={fn:i}),x.each(x.keys(i),function(t){"msg"!==t&&e.push({fn:D[t],val:i[t],msg:i.msg})}),e},[])),function(t,e){var i=x.extend({},c,D),n=e.fn.call(i,r,a,e.val,u,F);return!1!==n&&!1!==t&&(n&&!t?x.result(e,"msg")||n:t)},"");var t,e,i},u=function(t,e,i){e.associatedViews?e.associatedViews.push(t):e.associatedViews=[t],x.extend(e,n(t,i))},a=function(t,e){e&&1<t.associatedViews.length?t.associatedViews=x.without(t.associatedViews,e):(delete t.validate,delete t.preValidate,delete t.isValid,delete t.associatedViews)},r=function(t){u(this.view,t,this.options)},F=function(t){a(t)},{version:"0.12",configure:function(t){x.extend(d,t)},bind:function(e,i){var t=(i=x.extend({},d,l,i)).model||e.model,n=i.collection||e.collection;if(void 0===t&&void 0===n)throw"Before you execute the binding your view must have a model or a collection.\nSee http://thedersen.com/projects/backbone-validation/#using-form-model-validation for more information.";t?u(e,t,i):n&&(n.each(function(t){u(e,t,i)}),n.bind("add",r,{view:e,options:i}),n.bind("remove",F))},unbind:function(e,t){var i=(t=x.extend({},t)).model||e.model,n=t.collection||e.collection;i?a(i,e):n&&(n.each(function(t){a(t,e)}),n.unbind("add",r),n.unbind("remove",F))},mixin:(n=function(v,g){return{preValidate:function(t,e){var i,n=this,u={},a=x.extend({},this.attributes);return x.isObject(t)?(x.extend(a,t),x.each(t,function(t,e){(i=A(n,e,t,a))&&(u[e]=i)}),x.isEmpty(u)?void 0:u):A(this,t,e,a)},isValid:function(t){var i,e,n,u,a=this;return t=t||p(g,v),x.isString(t)?e=[t]:x.isArray(t)&&(e=t),e&&(i=C(a.attributes),x.each(e,function(e){(n=A(a,e,i[e],x.extend({},a.attributes)))&&((u=u||{})[e]=n),x.each(a.associatedViews,function(t){n?g.invalid(t,e,n,g.selector,a):g.valid(t,e,g.selector,a)})})),!0===t&&(u=this.validate()),u&&this.trigger("invalid",this,u,{validationError:u}),e?!u:!this.validation||this._isValid},validate:function(t,e){var i,n,u,a,r,F,o,s,d=this,c=!t,l=x.extend({},g,e),f=(o=d,s=(s=p(g,v))||x.keys(x.result(o,"validation")||{}),x.reduce(s,function(t,e){return t[e]=void 0,t},{})),m=x.extend({},f,d.attributes,t),h=C(m),D=t?C(t):h,b=(i=d,n=m,u=x.pick(h,x.keys(f)),r={},F=!0,x.each(u,function(t,e){(a=A(i,e,t,n))&&(r[e]=a,F=!1)}),{invalidAttrs:r,isValid:F});if(d._isValid=b.isValid,x.each(d.associatedViews,function(u){x.each(f,function(t,e){var i=b.invalidAttrs.hasOwnProperty(e),n=D.hasOwnProperty(e);i||l.valid(u,e,l.selector,d),i&&(n||c)&&l.invalid(u,e,b.invalidAttrs[e],l.selector,d)})}),x.defer(function(){d.trigger("validated",d._isValid,d,b.invalidAttrs),d.trigger("validated:"+(d._isValid?"valid":"invalid"),d,b.invalidAttrs)}),!l.forceUpdate&&0<x.intersection(x.keys(b.invalidAttrs),x.keys(D)).length)return b.invalidAttrs}}})(null,d)}),l=t.callbacks={valid:function(t,e,i){t.$("["+i+'~="'+e+'"]').removeClass("invalid").removeAttr("data-error")},invalid:function(t,e,i,n){t.$("["+n+'~="'+e+'"]').addClass("invalid").attr("data-error",i)}},f=t.patterns={digits:/^\d+$/,number:/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d*)?$/,email:/^((([a-z]|\d|[\[\]()!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[\[\]()!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i,url:/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i},m=t.messages={required:"{0} is required",acceptance:"{0} must be accepted",min:"{0} must be greater than or equal to {1}",max:"{0} must be less than or equal to {1}",range:"{0} must be between {1} and {2}",length:"{0} must be {1} characters",minLength:"{0} must be at least {1} characters",maxLength:"{0} must be at most {1} characters",rangeLength:"{0} must be between {1} and {2} characters",oneOf:"{0} must be one of: {1}",equalTo:"{0} must be the same as {1}",digits:"{0} must only contain digits",number:"{0} must be a number",email:"{0} must be a valid email",url:"{0} must be a valid url",inlinePattern:"{0} is invalid"},i=t.labelFormatters={none:function(t){return t},sentenceCase:function(t){return t.replace(/(?:^\w|[A-Z]|\b\w)/g,function(t,e){return 0===e?t.toUpperCase():" "+t.toLowerCase()}).replace(/_/g," ")},label:function(t,e){return e.labels&&e.labels[t]||i.sentenceCase(t,e)}},h=t.attributeLoaders={inputNames:function(t){var e=[];return t&&t.$("form [name]").each(function(){/^(?:input|select|textarea)$/i.test(this.nodeName)&&this.name&&"submit"!==this.type&&-1===e.indexOf(this.name)&&e.push(this.name)}),e}},D=t.validators=(e=String.prototype.trim?function(t){return null===t?"":String.prototype.trim.call(t)}:function(t){return null===t?"":t.toString().replace(/^\s+/,"").replace(/\s+$/,"")},o=function(t){return x.isNumber(t)||x.isString(t)&&t.match(f.number)},s=function(t){return!(x.isNull(t)||x.isUndefined(t)||x.isString(t)&&""===e(t)||x.isArray(t)&&x.isEmpty(t))},{fn:function(t,e,i,n,u){return x.isString(i)&&(i=n[i]),i.call(n,t,e,u)},required:function(t,e,i,n,u){var a=x.isFunction(i)?i.call(n,t,e,u):i;return!(!a&&!s(t))&&(a&&!s(t)?this.format(m.required,this.formatLabel(e,n)):void 0)},acceptance:function(t,e,i,n){if("true"!==t&&(!x.isBoolean(t)||!1===t))return this.format(m.acceptance,this.formatLabel(e,n))},min:function(t,e,i,n){if(!o(t)||t<i)return this.format(m.min,this.formatLabel(e,n),i)},max:function(t,e,i,n){if(!o(t)||i<t)return this.format(m.max,this.formatLabel(e,n),i)},range:function(t,e,i,n){if(!o(t)||t<i[0]||t>i[1])return this.format(m.range,this.formatLabel(e,n),i[0],i[1])},length:function(t,e,i,n){if(!x.isString(t)||t.length!==i)return this.format(m.length,this.formatLabel(e,n),i)},minLength:function(t,e,i,n){if(!x.isString(t)||t.length<i)return this.format(m.minLength,this.formatLabel(e,n),i)},maxLength:function(t,e,i,n){if(!x.isString(t)||t.length>i)return this.format(m.maxLength,this.formatLabel(e,n),i)},rangeLength:function(t,e,i,n){if(!x.isString(t)||t.length<i[0]||t.length>i[1])return this.format(m.rangeLength,this.formatLabel(e,n),i[0],i[1])},oneOf:function(t,e,i,n){if(!x.include(i,t))return this.format(m.oneOf,this.formatLabel(e,n),i.join(", "))},equalTo:function(t,e,i,n,u){if(t!==u[i])return this.format(m.equalTo,this.formatLabel(e,n),this.formatLabel(i,n))},pattern:function(t,e,i,n){if(!s(t)||!t.toString().match(f[i]||i))return this.format(m[i]||m.inlinePattern,this.formatLabel(e,n),i)}});return x.each(D,function(t,e){D[e]=x.bind(D[e],x.extend({},c,D))}),t}(e),t.Validation});