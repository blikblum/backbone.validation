!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("backbone"),require("underscore")):"function"==typeof define&&define.amd?define(["backbone","underscore"],e):(t.Backbone=t.Backbone||{},t.Backbone.Validation=e(t.Backbone,t._))}(this,function(t,e){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t,e=e&&e.hasOwnProperty("default")?e.default:e;var n,i,u,a,r,F,o,s,d,c,l={forceUpdate:!1,selector:"name",labelFormatter:"sentenceCase",valid:Function.prototype,invalid:Function.prototype},f={formatLabel:function(t,e){return g[l.labelFormatter](t,e)},format:function(){var t=Array.prototype.slice.call(arguments);return t.shift().replace(/\{(\d+)\}/g,function(e,n){return void 0!==t[n]?t[n]:e})}},m=function(t,n,i){return n=n||{},i=i||"",e.each(t,function(e,u){t.hasOwnProperty(u)&&(e&&"object"==typeof e&&e.constructor===Object&&m(e,n,i+u+"."),n[i+u]=e)}),n},h=(n=function(t,n){var i=t.attributes;if(e.isFunction(i)?i=i(n):e.isString(i)&&e.isFunction(x[i])&&(i=x[i](n)),e.isArray(i))return i},i=function(t,n,i,u){return e.reduce(function(t,n){var i=t.validation&&e.result(t,"validation")[n]||{};return e.isArray(i)||(i=[i]),e.reduce(i,function(t,n){return(e.isFunction(n)||e.isString(n))&&(n={fn:n}),e.each(e.keys(n),function(e){"msg"!==e&&t.push({fn:p[e],val:n[e],msg:n.msg})}),t},[])}(t,n),function(a,r){var F=e.extend({},f,p),o=r.fn.call(F,i,n,r.val,t,u);return!1!==o&&!1!==a&&(o&&!a?e.result(r,"msg")||o:a)},"")},a=function(t,n,i){n.associatedViews?n.associatedViews.push(t):n.associatedViews=[t],e.extend(n,u(t,i))},r=function(t,n){n&&t.associatedViews&&t.associatedViews.length>1?t.associatedViews=e.without(t.associatedViews,n):(delete t.validate,delete t.preValidate,delete t.isValid,delete t.associatedViews)},F=function(t){a(this.view,t,this.options)},o=function(t){r(t)},{version:"0.12",configure:function(t){e.extend(l,t)},bind:function(t,n){var i=(n=e.extend({},l,D,n)).model||t.model,u=n.collection||t.collection;if(void 0===i&&void 0===u)throw"Before you execute the binding your view must have a model or a collection.\nSee http://thedersen.com/projects/backbone-validation/#using-form-model-validation for more information.";i?a(t,i,n):u&&(u.each(function(e){a(t,e,n)}),u.bind("add",F,{view:t,options:n}),u.bind("remove",o))},unbind:function(t,n){var i=(n=e.extend({},n)).model||t.model,u=n.collection||t.collection;i?r(i,t):u&&(u.each(function(e){r(e,t)}),u.unbind("add",F),u.unbind("remove",o))},mixin:(u=function(t,u){return{preValidate:function(t,n){var u,a=this,r={},F=e.extend({},this.attributes);return e.isObject(t)?(e.extend(F,t),e.each(t,function(t,e){(u=i(a,e,t,F))&&(r[e]=u)}),e.isEmpty(r)?void 0:r):i(this,t,n,F)},isValid:function(a){var r,F,o,s,d=this;return a=a||n(u,t),e.isString(a)?F=[a]:e.isArray(a)&&(F=a),F&&(r=m(d.attributes),e.each(F,function(t){(o=i(d,t,r[t],e.extend({},d.attributes)))&&((s=s||{})[t]=o),e.each(d.associatedViews,function(e){o?u.invalid(e,t,o,u.selector,d):u.valid(e,t,u.selector,d)})})),!0===a&&(s=this.validate()),s&&this.trigger("invalid",this,s,{validationError:s}),F?!s:!this.validation||this._isValid},validate:function(a,r){var F=this,o=!a,s=e.extend({},u,r),d=function(t,n){return n=n||e.keys(e.result(t,"validation")||{}),e.reduce(n,function(t,e){return t[e]=void 0,t},{})}(F,n(u,t)),c=e.extend({},d,F.attributes,a),l=m(c),f=a?m(a):l,h=function(t,n,u){var a,r={},F=!0;return e.each(u,function(e,u){(a=i(t,u,e,n))&&(r[u]=a,F=!1)}),{invalidAttrs:r,isValid:F}}(F,c,e.pick(l,e.keys(d)));if(F._isValid=h.isValid,e.each(F.associatedViews,function(t){e.each(d,function(e,n){var i=h.invalidAttrs.hasOwnProperty(n),u=f.hasOwnProperty(n);i||s.valid(t,n,s.selector,F),i&&(u||o)&&s.invalid(t,n,h.invalidAttrs[n],s.selector,F)})}),e.defer(function(){F.trigger("validated",F._isValid,F,h.invalidAttrs),F.trigger("validated:"+(F._isValid?"valid":"invalid"),F,h.invalidAttrs)}),!s.forceUpdate&&e.intersection(e.keys(h.invalidAttrs),e.keys(f)).length>0)return h.invalidAttrs}}})(null,l)}),D=h.callbacks={valid:function(t,e,n){t.$("["+n+'~="'+e+'"]').removeClass("invalid").removeAttr("data-error")},invalid:function(t,e,n,i){t.$("["+i+'~="'+e+'"]').addClass("invalid").attr("data-error",n)}},b=h.patterns={digits:/^\d+$/,number:/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d*)?$/,email:/^((([a-z]|\d|[\[\]()!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[\[\]()!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i,url:/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i},v=h.messages={required:"{0} is required",acceptance:"{0} must be accepted",min:"{0} must be greater than or equal to {1}",max:"{0} must be less than or equal to {1}",range:"{0} must be between {1} and {2}",length:"{0} must be {1} characters",minLength:"{0} must be at least {1} characters",maxLength:"{0} must be at most {1} characters",rangeLength:"{0} must be between {1} and {2} characters",oneOf:"{0} must be one of: {1}",equalTo:"{0} must be the same as {1}",digits:"{0} must only contain digits",number:"{0} must be a number",email:"{0} must be a valid email",url:"{0} must be a valid url",inlinePattern:"{0} is invalid"},g=h.labelFormatters={none:function(t){return t},sentenceCase:function(t){return t.replace(/(?:^\w|[A-Z]|\b\w)/g,function(t,e){return 0===e?t.toUpperCase():" "+t.toLowerCase()}).replace(/_/g," ")},label:function(t,e){return e.labels&&e.labels[t]||g.sentenceCase(t,e)}},x=h.attributeLoaders={inputNames:function(t){var e=[];return t&&t.$("form [name]").each(function(){/^(?:input|select|textarea)$/i.test(this.nodeName)&&this.name&&"submit"!==this.type&&-1===e.indexOf(this.name)&&e.push(this.name)}),e}},p=h.validators=(s=String.prototype.trim?function(t){return null===t?"":String.prototype.trim.call(t)}:function(t){return null===t?"":t.toString().replace(/^\s+/,"").replace(/\s+$/,"")},d=function(t){return e.isNumber(t)||e.isString(t)&&t.match(b.number)},c=function(t){return!(e.isNull(t)||e.isUndefined(t)||e.isString(t)&&""===s(t)||e.isArray(t)&&e.isEmpty(t))},{fn:function(t,n,i,u,a){return e.isString(i)&&(i=u[i]),i.call(u,t,n,a)},required:function(t,n,i,u,a){var r=e.isFunction(i)?i.call(u,t,n,a):i;return!(!r&&!c(t))&&(r&&!c(t)?this.format(v.required,this.formatLabel(n,u)):void 0)},acceptance:function(t,n,i,u){if("true"!==t&&(!e.isBoolean(t)||!1===t))return this.format(v.acceptance,this.formatLabel(n,u))},min:function(t,e,n,i){if(!d(t)||t<n)return this.format(v.min,this.formatLabel(e,i),n)},max:function(t,e,n,i){if(!d(t)||t>n)return this.format(v.max,this.formatLabel(e,i),n)},range:function(t,e,n,i){if(!d(t)||t<n[0]||t>n[1])return this.format(v.range,this.formatLabel(e,i),n[0],n[1])},length:function(t,n,i,u){if(!e.isString(t)||t.length!==i)return this.format(v.length,this.formatLabel(n,u),i)},minLength:function(t,n,i,u){if(!e.isString(t)||t.length<i)return this.format(v.minLength,this.formatLabel(n,u),i)},maxLength:function(t,n,i,u){if(!e.isString(t)||t.length>i)return this.format(v.maxLength,this.formatLabel(n,u),i)},rangeLength:function(t,n,i,u){if(!e.isString(t)||t.length<i[0]||t.length>i[1])return this.format(v.rangeLength,this.formatLabel(n,u),i[0],i[1])},oneOf:function(t,n,i,u){if(!e.include(i,t))return this.format(v.oneOf,this.formatLabel(n,u),i.join(", "))},equalTo:function(t,e,n,i,u){if(t!==u[n])return this.format(v.equalTo,this.formatLabel(e,i),this.formatLabel(n,i))},pattern:function(t,e,n,i){if(!c(t)||!t.toString().match(b[n]||n))return this.format(v[n]||v.inlinePattern,this.formatLabel(e,i),n)}});return e.each(p,function(t,n){p[n]=e.bind(p[n],e.extend({},f,p))}),t.Validation=h,h});
